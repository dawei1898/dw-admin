# DW Admin 技术架构图

## 整体架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户层 (User Layer)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │   Web前端   │  │   移动端    │  │   第三方    │  │  API调用 │ │
│  │  (React)    │  │   (APP)     │  │    系统     │  │  (Client)│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     API网关层 (API Gateway Layer)                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │ │
│  │  │   CORS配置  │  │   跨域处理  │  │    请求过滤和转发         │ │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     控制层 (Controller Layer)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │ UserController│ │RoleController│ │FileController│ │LoginLog │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     服务层 (Service Layer)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │  UserService│ │ RoleService │ │FileService  │ │ LoginLog │ │
│  │ ┌─────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │ │  Service │ │
│  │ │UserRole │ │ │ │ 权限管理  │ │ │ 文件管理  │ │ │          │ │
│  │ │ Service │ │ │ │    缓存   │ │ │ 存储管理  │ │ │          │ │
│  │ └─────────┘ │ │ └─────────┘ │ │ └─────────┘ │ │          │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      数据访问层 (DAO Layer)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │ UserMapper  │  │ RoleMapper  │  │ FileMapper  │  │LoginLog │ │
│  │UserRoleMapper│ │    权限      │  │   文件      │  │  Mapper  │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘ │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    MyBatis Plus ORM                         │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    核心组件层 (Core Components)                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │   认证授权   │  │   权限控制   │  │   限流控制   │  │   日志   │ │
│  │ ┌─────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │ │ ┌────────┐│ │
│  │ │  JWT    │ │ │ │ Permission│ │ │  Limiter │ │ │  Log    ││ │
│  │ │  Token  │ │ │ │   AOP    │ │ │   AOP    │ │ │  Aspect ││ │
│  │ │  缓存    │ │ │ │  缓存     │ │ │  策略     │ │ │  记录   ││ │
│  │ └─────────┘ │ │ └─────────┘ │ │ └─────────┘ │ │ └────────┘│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     存储层 (Storage Layer)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐ │
│  │  本地存储    │  │    OSS      │  │    COS      │  │  Redis   │ │
│  │   Local     │  │   阿里云    │  │   腾讯云    │  │   缓存   │ │
│  │   文件       │  │   对象存储   │  │   对象存储   │  │   高速缓存│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    数据库层 (Database Layer)                       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    MySQL 数据库                              │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────┐ │ │
│  │  │   dwa_user  │  │  dwa_role   │  │  dwa_file   │  │登录  │ │ │
│  │  │   用户表    │  │   角色表    │  │   文件表    │  │  日志 │ │ │
│  │  │ ┌────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │ │表    │ │ │
│  │  │ │用户角色 │ │ │ │ 权限配置 │ │ │ │ 文件元 │ │ │      │ │ │
│  │  │ │ 关联表  │ │ │ │   缓存   │ │ │ │  数据  │ │ │      │ │ │
│  │  │ └────────┘ │ │ └─────────┘ │ │ └─────────┘ │ │      │ │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └──────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 核心组件详解

### 1. 认证授权组件 (Authentication & Authorization)
```
┌─────────────────────────────────────┐
│           JWT Token 认证流程          │
├─────────────────────────────────────┤
│ 1. 用户登录 → 生成JWT Token         │
│ 2. Token缓存到Redis               │
│ 3. 请求携带Token → 验证有效性       │
│ 4. 提取用户信息 → 用户上下文        │
│ 5. AOP拦截 → 权限验证              │
└─────────────────────────────────────┘
```

### 2. 权限控制系统
```
┌─────────────────────────────────────┐
│          权限控制架构                │
├─────────────────────────────────────┤
│ ┌─────────────┐  ┌─────────────┐   │
│ │ Permission  │  │ 权限缓存     │   │
│ │    AOP      │  │ (Redis)     │   │
│ └─────────────┘  └─────────────┘   │
│ ┌─────────────┐  ┌─────────────┐   │
│ │ 角色权限    │  │ 本地缓存     │   │
│ │   映射      │  │ (L1 Cache)  │   │
│ └─────────────┘  └─────────────┘   │
└─────────────────────────────────────┘
```

### 3. 文件存储架构
```
┌─────────────────────────────────────┐
│         文件存储统一接口              │
├─────────────────────────────────────┤
│ ┌─────────┐  ┌─────────┐  ┌──────┐ │
│ │ 本地存储 │  │  OSS    │  │ COS  │ │
│ │  Local  │  │ 阿里云  │  │ 腾讯 │ │
│ └─────────┘  └─────────┘  └──────┘ │
│ ┌─────────────────────────────────┐ │
│ │      存储策略配置                │ │
│ │    (StorageProperties)          │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 4. 限流控制机制
```
┌─────────────────────────────────────┐
│           限流控制流程               │
├─────────────────────────────────────┤
│ 1. AOP拦截请求 → 获取限流配置       │
│ 2. Redis计数器 → 检查限流规则       │
│ 3. 通过/拒绝 → 返回响应             │
│ 4. 记录限流日志 → 监控告警          │
└─────────────────────────────────────┘
```

### 5. 日志记录系统
```
┌─────────────────────────────────────┐
│          统一日志记录               │
├─────────────────────────────────────┤
│ ┌─────────────┐  ┌─────────────┐   │
│ │ LogAspect   │  │ LoginLog    │   │
│ │   AOP       │  │   控制器    │   │
│ └─────────────┘  └─────────────┘   │
│ ┌─────────────┐  ┌─────────────┐   │
│ │  操作日志   │  │  登录日志   │   │
│ │   记录      │  │   记录      │   │
│ └─────────────┘  └─────────────┘   │
└─────────────────────────────────────┘
```

## 数据流图

### 典型请求流程
```
用户请求 → API网关 → Controller → Service → DAO → MySQL
    ↓          ↓         ↓         ↓      ↓      ↓
  权限验证   跨域处理   参数验证   业务逻辑  SQL执行  数据返回
    ↓          ↓         ↓         ↓      ↓      ↓
权限检查 ← AOP拦截 ← 结果处理 ← 缓存检查 ← 结果 ← 响应组装
```

### 文件上传流程
```
用户上传 → Controller → Service → 存储策略 → 文件存储
    ↓         ↓         ↓         ↓         ↓
  权限验证  参数验证   业务处理   策略选择   存储后端
    ↓         ↓         ↓         ↓         ↓
  Token检查  文件校验   元数据记录  存储配置   URL返回
```

## 技术栈总结

| 层级 | 技术组件 | 说明 |
|------|---------|------|
| 构建工具 | Maven | 项目构建和依赖管理 |
| Web框架 | Spring Boot | 应用程序框架 |
| 数据访问 | MyBatis Plus | ORM框架 |
| 数据库 | MySQL | 关系型数据库 |
| 缓存 | Redis | 分布式缓存 |
| 认证 | JWT | 无状态认证 |
| 对象存储 | OSS/COS | 云存储服务 |
| 本地存储 | Local File System | 本地文件存储 |
| 日志 | Logback | 日志框架 |
| API文档 | SpringDoc | API文档生成 |
| 开发工具 | IntelliJ IDEA | 集成开发环境 |

## 架构特点

1. **分层架构**: 清晰的分层设计，便于维护和扩展
2. **组件化**: 高度组件化，功能模块独立
3. **缓存策略**: 多级缓存(Redis + 本地缓存)
4. **安全控制**: JWT + 权限AOP + 限流控制
5. **存储抽象**: 统一存储接口，支持多种后端
6. **日志监控**: 全面的日志记录和监控
7. **配置外化**: 通过配置文件管理各种参数
8. **扩展性**: 良好的扩展性，易于添加新功能